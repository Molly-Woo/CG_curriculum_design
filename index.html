<!DOCTYPE html>
<html lang="en">

<head>
    <title>水晶球世界</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="css/main.css">
</head>

<body>

    <script type="module">

        import * as THREE from './js/three.module.js';

        import { GUI } from './js/dat.gui.module.js';
        import { OrbitControls } from './js/OrbitControls.js';

        let controls, camera, scene, renderer;
        let textureEquirec, textureCube;
        let sphereMesh, sphereMaterial;

        init();
        animate();

        function init() {

            // CAMERAS

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 100000);
            camera.position.set(0, 0, 1000);

            // SCENE

            scene = new THREE.Scene();

            // Lights

            const ambient = new THREE.AmbientLight(0xffffff);
            scene.add(ambient);

            // Textures

            const loader = new THREE.CubeTextureLoader();
            loader.setPath('textures/skybox/');

            textureCube = loader.load(['px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg']);
            textureCube.encoding = THREE.sRGBEncoding;

            scene.background = textureCube;

            //

            const geometry = new THREE.IcosahedronBufferGeometry(400, 15);
            sphereMaterial = new THREE.MeshLambertMaterial({ envMap: textureCube });
            sphereMesh = new THREE.Mesh(geometry, sphereMaterial);
            scene.add(sphereMesh);

            //

            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            document.body.appendChild(renderer.domElement);

            //

            controls = new OrbitControls(camera, renderer.domElement);
            controls.minDistance = 500;
            controls.maxDistance = 2500;

            //

            const params = {
                Cube: function () {

                    scene.background = textureCube;

                    sphereMaterial.envMap = textureCube;
                    sphereMaterial.needsUpdate = true;

                },
                Refraction: false
            };
            window.addEventListener('resize', onWindowResize, false);

        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        //

        function animate() {

            requestAnimationFrame(animate);

            render();

        }

        function render() {

            camera.lookAt(scene.position);
            renderer.render(scene, camera);

        }

    </script>
    <div style="width: 350px;
                height: 400px;
                position: absolute;
                top: 50px;
                right: 0px;
                background-image: url(textures/paper.png);
                background-size:300px;
                background-repeat:no-repeat;
    ">
    <div class="incantation" style = "margin:65px 0 0 70px;height:40px;color: #fff; font-size: 20px;line-height: 40px;" onclick = "snow()">下雪了</div>
    <div class="incantation" style = "margin:25px 0 0 70px;height:40px;color: #fff; font-size: 20px;line-height: 40px;" onclick = "viewchange()">进入水晶球世界</div>
    <div class="incantation" style = "margin:25px 0 0 70px;height:40px;color: #fff; font-size: 20px;line-height: 40px;" onclick = "call()">召唤麋鹿</div>
    <div class="incantation" style = "margin:25px 0 0 70px;height:40px;color: #fff; font-size: 20px;line-height: 40px;" onclick = "turn_up()">点亮圣诞树</div>
    </div>
    <script type="text/javascript" src="js/back.js" ></script>
</body>

</html>